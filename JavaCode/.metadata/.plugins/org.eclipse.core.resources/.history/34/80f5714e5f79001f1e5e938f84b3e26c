package cs523.bitcoinprice.consumer;

import org.apache.hadoop.hbase.TableName;
import org.apache.hadoop.hbase.client.Connection;
import org.apache.hadoop.hbase.client.Put;
import org.apache.hadoop.hbase.client.Table;

import java.io.IOException;

public class BitcoinPriceHbaseTable {

    private static final String TABLE_NAME = "bitcoin_price";
    private static final String COLUMN_FAMILY = "price-info";

    private final Table hbaseTable;

    public BitcoinPriceHbaseTable(Connection connection) throws IOException {
        this.hbaseTable = connection.getTable(TableName.valueOf(TABLE_NAME));
    }

    public void addPrice(BitcoinPrice bitcoinPrice) throws IOException {
        Put put = new Put(bitcoinPrice.getAssetId().getBytes());
        put.addColumn(COLUMN_FAMILY.getBytes(), "price".getBytes(), String.valueOf(bitcoinPrice.getPrice()).getBytes());
        put.addColumn(COLUMN_FAMILY.getBytes(), "timestamp".getBytes(), bitcoinPrice.getTimestamp().getBytes());
        put.addColumn(COLUMN_FAMILY.getBytes(), "size".getBytes(), String.valueOf(bitcoinPrice.getSize()).getBytes());

        hbaseTable.put(put);
        System.out.println("Stored BitcoinPrice in HBase: " + bitcoinPrice);
    }

    public void close() throws IOException {
        if (hbaseTable != null) {
            hbaseTable.close();
        }
    }
}

